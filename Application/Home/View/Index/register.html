<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <title>{$title}</title>

    <link rel="shortcut icon" type="image/png" href="__PUBLIC__/img/favicon.ico">
    <link rel="stylesheet" href="__PUBLIC__/css/base.head.css" />
    <link rel="stylesheet" href="__PUBLIC__/css/base.foot.css" />
    <link rel="stylesheet" href="__PUBLIC__/js/layui/css/layui.css" />
    <link rel="stylesheet" href="__PUBLIC__/css/bootstrap.min.css" />

    <style type="text/css">
        .passcheck{position:absolute;width:282px;height:104px;top:0;left:332px;background:#fff;border:1px solid #f0efed;padding:5px 10px;box-sizing: border-box;border-radius:6px;display: none;}
        .checkbar{width:154px;height:15px;display: inline-block;vertical-align: middle;border-radius: 3px;overflow: hidden;}
        .checkbar span{width:50px;height:15px;float:left;margin-right: 2px;background: #eee;}
        .checkbar span.three{margin-right:0;}
        .checklist{margin-top:5px;}
        .checklist li{padding:1px 0;font-size:12px;}
        .checklist b{display: inline-block;width:20px;height:20px;vertical-align: middle;background: url(../../../../Public/img/1531891081.png) no-repeat;background-size: 15px; }
        .checklist .right b{background: url(../../../../Public/img/1550215311.png) no-repeat 1px; background-size: 13px;}
        .checklist .err b{background: url(../../../../Public/img/1550215325.png) no-repeat 1px;background-size: 13px;}
        .cicon{display: block;width:12px;height:12px;position: absolute;top:15px;left:-10px; }
    </style>

</head>
<body>
    <header>
        <div class="loheader">
            <div class="htop">
                <div class="hlogo">
                    <a title="豆果美食" href="{:U('index')}">豆果美食</a>
                </div>
            </div>
        </div>
    </header>
    <div id="main" class="clearfix">
        <div class="bglo clearfix">
            <div class="thed">
                <h2>新用户注册</h2>
                <span>已有账号，
                    <a href="{:U('login')}">直接登录 ></a>
                </span>
            </div>
            <div class="logibox">
                <div class="itm clearfix">
                    <div class="iput">
                        <input id="username" placeholder="请输入手机号" autocomplete="off" onfocus="showdesc(this)" onblur="username(this.value);" class="wwinct r5" type="text" />
                    </div>
                    <span class="lowrong mll" id="err_username">
                        <p></p>
                    </span>
                </div>
                <div class="iisi" style="visibility: visible;">输入常用的手机号，便于登录和找回密码</div>
                <div class="itm clearfix">
                    <div class="iput">
                        <input id="nickname" placeholder="请输入昵称" onfocus="showdesc(this)" onblur="nickname(this.value);" class="wwinct r5" maxlength="16" type="text" />
                    </div>
                    <span class="lowrong mll" id="err_nickname">
                        <p></p>
                    </span>
                </div>
                <div class="iisi">中英文均可，最多16个字喔~</div>
                <div class="itm clearfix" style="position: relative;">
                    <div class="iput">
                        <input id="password" placeholder="请输入密码" onfocus="showdesc(this)" onblur="password(this.value);" class="wwinct r5" maxlength="20" type="password" />
                    </div>
                    <span class="lowrong mll" id="err_password">
                        <p></p>
                    </span>
                </div>
                <div class="iisi">密码长度为6-20位，不能含有空格或纯数字（字母）</div>
                <div class="itm clearfix">
                    <div class="iput">
                        <input id="dpasswd" placeholder="确认密码" onfocus="showdesc(this)" onblur="rePassword(this.value);" class="wwinct r5" maxlength="20" type="password">
                    </div>
                    <span class="lowrong mll" id="err_dpasswd">
                        <p></p>
                    </span>
                </div>
                <div class="iisi">再输入一次密码</div>
                <div class="itm clearfix" id="jiaoyanma_div">
                    <div class="yanm">
                        <input id="code" class="yzma r5" maxlength="6" type="text" placeholder="输入验证码" disabled=""/>
                        <button class="btn" style="margin-top:-9px;font-size:12px;height:34px;width:132px;margin-left:53px;" id="send_vercode" disabled onclick="$('#code').val('8888')">获取验证码</button>
                    </div>
                </div>
                <div class="itm clearfix">
                    <span class="lowrong mll" id="err_code" style="margin-left: 65px">
                        <p></p>
                    </span>
                </div>
                <div class="iloo" style="margin-bottom: 30px;">
                    <span class="lxieyi">
                        <input type="checkbox" class="czl" id="agreement">
                        我已阅读并且同意
                        <a href="http://www.douguo.com/privacy.html" target="_blank" title="用户协议">豆果美食使用协议</a>
                        <b id="agreement_tip" class="fwn ff0 pls"></b>
                    </span>
                    <button id="signup" type="button" class="btnrdz r3" onclick="signup()"  style="background: #FFB31A">注册</button>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <div id="footer">
            <div class="foot ptm">
                <div class="clink relative">
                    <a href="#" rel="nofollow" target="_blank">关于豆果</a>
                     ·
                    <a href="#" rel="nofollow" target="_blank">在豆果工作</a>
                     ·
                    <a href="#" rel="nofollow" target="_blank">意见反馈</a>
                     ·
                    <a href="#" rel="nofollow" target="_blank">友情链接</a>
                     ·
                    <a href="#" rel="nofollow" target="_blank">菜谱大全</a>
                     ·
                    <a href="#" rel="nofollow" target="_blank">品牌馆</a>
                </div>
            </div>
            <div class="cght" style="font-size: 8px;margin-left: 25%">
                ©2009-2015
                <a href="#" target="_blank">北京豆果信息技术有限公司</a>
                <a href="#" target="_blank" rel="nofollow">京ICP证111032号</a>
                京公网安备11010102001133号 京网文[2014]0774-174号
            </div>
            <div class="botfans mt15">
                <span class="bonefans"></span>
                <span class="bonefans"></span>
                <span class="bonefans"></span>
            </div>
        </div>
    </footer>

    <script src="__PUBLIC__/js/base.js"></script>
    <script src='__PUBLIC__/js/jquery.js' ></script>
    <script src="__PUBLIC__/js/jquery-3.4.1.min.js"></script>
    <script src="__PUBLIC__/js/layui/layui.all.js"></script>
    <script src="__PUBLIC__/js/layer/layer.js"></script>
    <script>
        function showdesc(obj) {
            obj	= $(obj);
            obj.parents('.itm').next().css({'visibility':'visible'});
        }
        function username(v) {
            $('#err_username > p').text('').removeClass('ver_success');
            if(!v) {
                $('#err_username > p').text('手机号不能为空！');
                $('.btn').attr('disabled', 'disabled');
            } else {
                var phone = /^1[3|4|5|6|7|8][0-9]\d{8}$/;
                if(v && phone.test(v)) {
                    var status = selfCheck("{:U('check')}",'user','username','=',v);
                    console.log(status);
                    if(status) {
                        $('#err_username > p').text('手机号已被注册！');
                        $('.btn').attr('disabled', 'disabled');
                    } else {
                        $('#err_username > p').addClass('ver_success');
                        $('#err_username').parents('.itm').next().css({'visibility':'hidden'});
                        $('.btn').removeAttr('disabled');
                    }
                } else {
                    $('#err_username > p').text('输入的手机号格式错误！');
                    $('.btn').attr('disabled', 'disabled');
                }
            }
        }
        function nickname(v) {
            $('#err_nickname > p').text('').removeClass('ver_success');
            if(!v) {
                $('#err_nickname > p').text('昵称不能为空！');
            } else {
                if(v.length >= 2 || v.length <= 16) {
                    var status = selfCheck("{:U('check')}",'user','nickname','=',v);
                    if(status) {
                        $('#err_nickname > p').text('昵称已被使用！');
                    } else {
                        $('#err_nickname > p').addClass('ver_success');
                        $('#err_nickname').parents('.itm').next().css({'visibility':'hidden'});
                    }
                } else {
                    $('#err_nickname > p').text('请输入2~16个字的昵称！');
                }
            }
        }

        function password(v) {
            $('#err_password > p').text('').removeClass('ver_success');
            var regNumber = /\d+/;
            var regString = /[a-zA-Z]+/;
            var regSpecial= /[-~!@#$%^&*()/\|,.<>?"'();:_+=\[\]{}]/;
            var check_3 = 0;
            if(regNumber.test(v)){
                check_3 += 1;
            }
            if(regString.test(v)){
                check_3 += 1;
            }
            if(regSpecial.test(v)){
                check_3 += 1;
            }
            if(!v) {
                $('#err_password > p').text('一定要设置密码！');
            } else {
                if(v.length < 6 || v.length > 20 || v.indexOf(" ") != -1 || check_3 < 2) {
                    $('#err_password > p').text('密码不符合我们的要求！');
                } else {
                    $('#err_password > p').addClass('ver_success');
                    $('#err_password').parents('.itm').next().css({'visibility':'hidden'});
                }
            }
        }

        function rePassword(v) {
            $('#err_dpasswd > p').text('').removeClass('ver_success');
            if(v !== $('#password').val()) {
                $('#err_dpasswd > p').text('两次密码不同！');
            } else {
                $('#err_dpasswd > p').addClass('ver_success');
                $('#err_dpasswd').parents('.itm').next().css({'visibility':'hidden'});
            }
        }
        
        function signup() {
            if($('#agreement').is(":checked") != true) {
                $('#agreement_tip').html('请确认您已阅读并同意');
            } else if($('#err_username > p').attr('class') != 'ver_success' || $('#err_nickname > p').attr('class') != 'ver_success' || $('#err_password > p').attr('class') != 'ver_success' || $('#err_dpasswd > p').attr('class') != 'ver_success') {
                layer.msg('请确保信息填写正确和完整');
            } else if($('#code').val() == '') {
                $('#err_code > p').text('验证码不能为空！');
            } else if($('#code').val() != 8888) {
                $('#err_code > p').text('验证码错误！');
            } else {
                var data = {};
                $('input').each(function () {
                    data[$(this).attr('id')] = $(this).val();
                });
                delete data['dpasswd'];
                delete data['code'];
                delete data['agreement'];
                selfAjax(
                    "{:U('register')}",
                    "post",
                    data,
                    false,
                    function (data) {
                        if(data) location.href = "{:U('index')}";
                    }
                );
            }
        }
    </script>
</body>
</html>